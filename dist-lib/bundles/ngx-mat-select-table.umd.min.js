!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("util"),require("@angular/cdk/coercion"),require("rxjs/operators"),require("@angular/core"),require("@angular/common"),require("ngx-mat-select-search"),require("@angular/material"),require("@angular/forms")):"function"==typeof define&&define.amd?define("ngx-mat-select-table",["exports","rxjs","util","@angular/cdk/coercion","rxjs/operators","@angular/core","@angular/common","ngx-mat-select-search","@angular/material","@angular/forms"],t):t(e["ngx-mat-select-table"]={},e.rxjs,e.util,e.ng.cdk.coercion,e.rxjs.operators,e.ng.core,e.ng.common,e.ngxMatSelectSearch,e.ng.material,e.ng.forms)}(this,function(e,t,d,a,l,r,n,o,i,s){"use strict";function c(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,l=r.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(n=l.next()).done;)o.push(n.value)}catch(i){a={error:i}}finally{try{n&&!n.done&&(r=l["return"])&&r.call(l)}finally{if(a)throw a.error}}return o}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}var p=(m.prototype.ngOnInit=function(){var a=this;this.multiple=this.multiple||!1,this.matSelect.openedChange.pipe(l.takeUntil(this._onDestroy)).subscribe(function(e){if(!1===a.resetFiltersOnOpen&&a.matOptions.length||a.resetFilters(),a.overallSearchVisibleState=a.overallSearchVisible,!1!==a.resetSortOnOpen&&a.sort.sort({id:"",start:"asc",disableClear:!1}),e){a.overallSearchEnabled&&a.proxyMatSelectSearchConfiguration(a.matSelectSearchConfigurator),a.table._headerRowDefChanged=!0,setTimeout(function(){return[].forEach.call(a.tableRef.nativeElement.querySelectorAll("button.mat-sort-header-button"),function(e){return e.disabled=!0})});var t=a.matSelect.panel.nativeElement,r=t.getBoundingClientRect().height,n=0;a.table._getRenderedRows(a.table._headerRowOutlet).concat(a.table._getRenderedRows(a.table._footerRowOutlet)).forEach(function(e){return n+=e.getBoundingClientRect().height}),isNaN(r)||(t.style.maxHeight=r+n+"px"),!a.matSelectSearchConfigurator.disableScrollToActiveOnOptionsChanged&&!d.isNullOrUndefined(a.matSelect._keyManager)&&0<a.completeRowList.length&&a._onSelectOpen.pipe(l.takeUntil(a._onDestroy),l.debounceTime(1),l.take(1)).subscribe(function(){for(var e=""+a.completeRowList[0].id,t=0;t<a.tableDataSource.length;t++)if(""+a.tableDataSource[t].id==e){a.matSelect._keyManager.setActiveItem(t);try{a.cd.detectChanges()}catch(r){}break}})}else a.close.emit(!e)})},m.prototype.ngAfterViewInit=function(){var r=this;t.merge.apply(void 0,u([this._onOptionsChange,this.sort.sortChange,this.filterControls.valueChanges,this.overallFilterControl.valueChanges])).pipe(l.takeUntil(this._onDestroy),l.debounceTime(100)).subscribe(function(){var e=u((r.dataSource||{data:[]}).data||[]);r.addNullRow()&&e.unshift(r.nullRow),r.overallSearchEnabled&&r.overallSearchVisibleState?r.applyOverallFilter(e):r.applyColumnLevelFilters(e),r.sort.active||d.isNullOrUndefined(r.defaultSort)||!r.defaultSort.active||(r.sort.active=r.defaultSort.active,r.sort.direction=r.defaultSort.direction),r.tableDataSource=r.sort.active?r.sortData(e,r.sort.active,r.sort.direction):e;try{r.cd.detectChanges()}catch(t){}r._onSelectOpen.next()}),this.matOptions.changes.subscribe(function(){var t={};r.matOptions.toArray().filter(function(e){return!d.isNullOrUndefined(e)}).forEach(function(e){return t[""+e.value]=e}),r.matSelect.options.reset(r.tableDataSource.filter(function(e){return!d.isNullOrUndefined(t[""+e.id])}).map(function(e){return t[""+e.id]})),r.matSelect.options.notifyOnChanges()}),d.isNullOrUndefined(this.matSelect._keyManager)||this.matSelect._keyManager.change.pipe(l.takeUntil(this._onDestroy)).subscribe(function(e){return r.tableActiveRow=e})},m.prototype.ngOnDestroy=function(){this._onSelectOpen.complete(),this._onDestroy.next(),this._onDestroy.complete()},m.prototype.registerOnChange=function(r){var n=this;this.matSelect.registerOnChange(function(t){if(!0===n.multiple){for(var e=n.completeValueList.length-1;0<=e;e--)n.filteredOutRows[""+n.completeValueList[e]]===undefined&&-1===t.indexOf(n.completeValueList[e])&&n.completeValueList.splice(e,1);t.filter(function(e){return-1===n.completeValueList.indexOf(e)}).forEach(function(e){return n.completeValueList.push(e)}),n.matSelect.value=n.completeValueList,r(n.completeValueList),n.completeRowList.splice(0),((n.dataSource||{data:[]}).data||[]).filter(function(e){return-1!==n.completeValueList.indexOf(e.id)}).forEach(function(e){return n.completeRowList.push(e)})}else r(t),n.completeRowList.splice(0),((n.dataSource||{data:[]}).data||[]).filter(function(e){return e.id===t}).forEach(function(e){return n.completeRowList.push(e)})})},m.prototype.registerOnTouched=function(e){this.matSelect.registerOnTouched(e)},m.prototype.setDisabledState=function(e){this.matSelect.setDisabledState(e)},m.prototype.writeValue=function(e){this.updateCompleteRowList(e),this.matSelect.writeValue(e),this.matSelect.value!==e&&(this.matSelect.value=e)},m.prototype.ngOnChanges=function(e){var t=this;if(d.isNullOrUndefined(e.resetFiltersOnOpen)||!1===e.resetFiltersOnOpen.currentValue||this.resetFilters(),d.isNullOrUndefined(e.dataSource)||this.updateCompleteRowList(this.completeRowList.map(function(e){return e.id})),!d.isNullOrUndefined(e.matSelectConfigurator)){var r=e.matSelectConfigurator.currentValue;Object.keys(r).filter(function(e){return!["multiple","panelClass"].includes(e)&&!t.controlValueAccessorKeys.includes(e)}).forEach(function(e){return t.matSelect[e]=r[e]});var n=[];n.push("mat-select-search-table-panel"),d.isNullOrUndefined(r.panelClass)||n.push(r.panelClass),this.overallSearchEnabled&&n.push("mat-select-search-panel"),this.matSelect.panelClass=n}d.isNullOrUndefined(e.matSelectSearchConfigurator)||this.proxyMatSelectSearchConfiguration(e.matSelectSearchConfigurator.currentValue),d.isNullOrUndefined(e.dataSource)||d.isNullOrUndefined(e.dataSource.currentValue)||!d.isArray(e.dataSource.currentValue.data)||(this.tableDataSource=u(e.dataSource.currentValue.data),this.addNullRow()&&this.tableDataSource.unshift(this.nullRow),this.tableColumns=u(["_selection"],e.dataSource.currentValue.columns.map(function(e){return e.key})),this.tableColumnsMap.clear(),e.dataSource.currentValue.columns.forEach(function(e){return t.tableColumnsMap.set(e.key,e)}),this.applyProxyToArray(e.dataSource.currentValue.data,function(){t._onOptionsChange.next()}),this._onOptionsChange.next())},m.prototype.emulateMatOptionClick=function(e){if(!e.composedPath().filter(function(e){return e instanceof HTMLElement}).some(function(e){return"mat-option"===e.tagName.toLowerCase()})&&e.target instanceof HTMLElement){for(var t=e.target;null!=t&&t instanceof HTMLElement&&"tr"!==t.tagName.toLowerCase();)t=t.parentElement;if(null!==t){var r=t.querySelector("mat-option");r&&r.click()}}},m.prototype.filterFormControl=function(e){return this.filterControls.contains(e)||this.filterControls.registerControl(e,new s.FormControl("")),this.filterControls.get(e)},m.prototype.simpleTriggerLabelFn=function(e){var t=this;return d.isNullOrUndefined(this.triggerLabelSort)||this.sortData(e,this.triggerLabelSort.active,this.triggerLabelSort.direction),e.map(function(r){if(d.isNullOrUndefined(r))return"";if(d.isNullOrUndefined(t.customTriggerLabelTemplate)||"string"!=typeof t.customTriggerLabelTemplate||0===t.customTriggerLabelTemplate.trim().length)return""+r.id;var n=!1,e=t.customTriggerLabelTemplate.replace(/[$]{1}[{]{1}([^}]+)[}]{1}?/g,function(e,t){return!d.isNullOrUndefined(r[t])&&(n=!0)?r[t]:""});return!1===n?""+r.id:e.trim()}).join(", ")},m.prototype.toggleOverallSearch=function(){var e=this;this.overallSearchVisibleState=!this.overallSearchVisibleState,this.resetFilters(),this.overallSearchVisibleState&&setTimeout(function(){return e.matSelectSearch._focus()})},m.prototype.updateCompleteRowList=function(e){var r=this;this.completeRowList.splice(0),this.completeValueList.splice(0),d.isNullOrUndefined(e)||(d.isArray(e)?e:[e]).filter(function(e){return!d.isNullOrUndefined(e)}).forEach(function(t){((r.dataSource||{data:[]}).data||[]).filter(function(e){return!d.isNullOrUndefined(e)&&!d.isNullOrUndefined(e.id)&&e.id===t}).forEach(function(e){r.completeRowList.push(e),r.completeValueList.push(e.id)})})},m.prototype.proxyMatSelectSearchConfiguration=function(t){var r=this;d.isNullOrUndefined(this.matSelectSearch)||Object.keys(t).filter(function(e){return!["clearSearchInput"].includes(e)&&!r.controlValueAccessorKeys.includes(e)}).forEach(function(e){return r.matSelectSearch[e]=t[e]})},m.prototype.applyColumnLevelFilters=function(e){var r=this;this.filteredOutRows={};var t={};Object.keys(this.filterControls.controls).filter(function(e){return r.tableColumnsMap.has(e)&&!d.isNullOrUndefined(r.tableColumnsMap.get(e).filter)&&!1!==r.tableColumnsMap.get(e).filter.enabled}).filter(function(e){var t=r.filterControls.get(e).value;return!d.isNullOrUndefined(t)&&(d.isArray(t)&&0<t.length||"string"==typeof t&&0<t.trim().length||"number"==typeof t&&0<(""+t).trim().length)}).forEach(function(e){return t[e]={filter:r.tableColumnsMap.get(e).filter,value:r.filterControls.get(e).value}});for(var n=Object.keys(t),a=e.length-1;0<=a;a--)for(var l=0;l<n.length;l++){var o=n[l],i=e[a],s=i[o];if(d.isNullOrUndefined(s))e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});else{var c=t[o],u=c.filter.comparator;if("function"==typeof c.filter.comparatorFn){if(!c.filter.comparatorFn.call(null,s,c.value,i)){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if(d.isNullOrUndefined(u)||"equals"===u){if(c.value!==s){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if("string"==typeof s&&"string"==typeof c.value){var p=(""+s).toLowerCase(),m=c.value.toLowerCase();if(d.isNullOrUndefined(u)||"equalsIgnoreCase"===u){if(m!==p){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if("contains"===u){if(-1===s.indexOf(c.value)){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if("containsIgnoreCase"===u){if(-1===p.indexOf(m)){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if("startsWith"===u){if(!s.startsWith(c.value)){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if("startsWithIgnoreCase"===u&&!p.startsWith(m)){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}}}},m.prototype.applyOverallFilter=function(e){var t=this;if(this.filteredOutRows={},!d.isNullOrUndefined(this.overallFilterControl.value)){var r=this.overallFilterControl.value.toLowerCase();if(0!==r.trim().length)for(var n=e.length-1;0<=n;n--){for(var a=e[n],l=!0,o=this.dataSource.columns.length-1;0<=o;o--){var i=a[this.dataSource.columns[o].key];if(!d.isNullOrUndefined(i)&&-1!==(""+i).toLowerCase().indexOf(r)){l=!1;break}}l&&e.splice(n,1).forEach(function(e){return t.filteredOutRows[""+e.id]=e})}}},m.prototype.applyProxyToArray=function(r,n){["pop","push","reverse","shift","unshift","splice","sort"].forEach(function(t){r[t]=function(){var e=Array.prototype[t].apply(r,arguments);return n.apply(r,arguments),e}})},m.prototype.resetFilters=function(){var t=this;this.overallFilterControl.setValue(""),Object.keys(this.filterControls.controls).forEach(function(e){return t.filterControls.get(e).setValue("")})},m.prototype.sortingDataAccessor=function(e,t){var r=e[t];if(a._isNumberValue(r)){var n=Number(r);return n<9007199254740991?n:r}return r},m.prototype.sortData=function(e,a,t){var l=this;return a&&""!==t?e.sort(function(e,t){var r=l.sortingDataAccessor(e,a),n=l.sortingDataAccessor(t,a);return null===e.id?-1:null===t.id?1:r===n?0:d.isNullOrUndefined(r)&&!d.isNullOrUndefined(n)?-1:!d.isNullOrUndefined(r)&&d.isNullOrUndefined(n)?1:(r instanceof Date&&(r=r.getTime()),n instanceof Date&&(n=n.getTime()),d.isString(r)&&d.isString(n)?r.localeCompare(n)*("asc"===l.sort.direction?1:-1):(r=isNaN(r)?""+r:+r,n=isNaN(n)?""+n:+n,d.isString(r)&&d.isNumber(n)?"asc"===l.sort.direction?1:-1:d.isNumber(r)&&d.isString(n)?-1*("asc"===l.sort.direction?1:-1):(n<r?1:-1)*("asc"===l.sort.direction?1:-1)))}):e},m.prototype.addNullRow=function(){return!this.multiple&&!d.isNullOrUndefined(this.labelForNullValue)},m.decorators=[{type:r.Component,args:[{selector:"ngx-mat-select-table",template:'<mat-form-field>\r\n  <mat-select #componentSelect\r\n              [multiple]="multiple"\r\n              disableRipple>\r\n\r\n    <mat-select-trigger>\r\n      <ng-container *ngIf="!customTriggerLabelFn">{{simpleTriggerLabelFn(completeRowList)}}</ng-container>\r\n      <ng-container *ngIf="customTriggerLabelFn">{{customTriggerLabelFn(completeRowList)}}</ng-container>\r\n    </mat-select-trigger>\r\n\r\n    <ngx-mat-select-search *ngIf="overallSearchEnabled"\r\n                           [formControl]="overallFilterControl"\r\n                           [clearSearchInput]="resetFiltersOnOpen"\r\n                           [ngClass]="{hidden: overallSearchVisibleState !== true}">\r\n      <mat-icon *ngIf="matSelectSearchConfigurator?.clearIcon"\r\n                ngxMatSelectSearchClear\r\n                color="primary">{{matSelectSearchConfigurator.clearIcon}}</mat-icon>\r\n    </ngx-mat-select-search>\r\n    <mat-icon *ngIf="overallSearchEnabled"\r\n              (click)="toggleOverallSearch()"\r\n              class="overall-search-toggle"\r\n              color="primary">{{overallSearchVisibleState ? \'arrow_back\' : \'search\'}}</mat-icon>\r\n\r\n    <table #table\r\n           mat-table\r\n           matSort\r\n           [dataSource]="tableDataSource">\r\n\r\n      <ng-container *ngFor="let columnKey of tableColumns; let i = index"\r\n                    [matColumnDef]="columnKey"\r\n                    [ngSwitch]="columnKey">\r\n\r\n        <ng-container *ngSwitchCase="\'_selection\'">\r\n          <th mat-header-cell *matHeaderCellDef [ngClass]="{selection: true, hidden: !multiple}"></th>\r\n          <td mat-cell *matCellDef="let row" [ngClass]="{selection: true, hidden: !multiple}">\r\n            <mat-option [value]="row.id"></mat-option>\r\n          </td>\r\n        </ng-container>\r\n\r\n        <ng-container *ngSwitchDefault>\r\n          <th mat-header-cell\r\n              mat-sort-header\r\n              [disabled]="!tableColumnsMap.get(columnKey).sortable"\r\n              *matHeaderCellDef>\r\n            \x3c!-- Header cell --\x3e\r\n            <ng-container [ngSwitch]="tableColumnsMap.get(columnKey).filter?.type">\r\n              <ng-container *ngSwitchCase="\'string\'"\r\n                            [ngTemplateOutlet]="filterTypeString"\r\n                            [ngTemplateOutletContext]="{column: tableColumnsMap.get(columnKey)}"></ng-container>\r\n\r\n              <div *ngSwitchDefault>{{tableColumnsMap.get(columnKey).name}}</div>\r\n            </ng-container>\r\n          </th>\r\n          <td mat-cell *matCellDef="let row"\r\n              [colSpan]="addNullRow() && row.id === null && i === 1 ? tableColumns.length : 1"\r\n              [ngStyle]="{display: addNullRow() && row.id === null && i !== 1 ? \'none\' : \'\'}"\r\n          >\r\n            {{addNullRow() && row.id === null && i === 1 ? labelForNullValue : row[columnKey]}}\r\n          </td>\r\n        </ng-container>\r\n\r\n      </ng-container>\r\n\r\n      <tr mat-header-row *matHeaderRowDef="tableColumns; sticky: true"></tr>\r\n      <tr mat-row *matRowDef="let row; columns: tableColumns; let i = index"\r\n          (click)="emulateMatOptionClick($event)"\r\n          [ngClass]="{active: i === tableActiveRow}"></tr>\r\n    </table>\r\n\r\n  </mat-select>\r\n</mat-form-field>\r\n\r\n<ng-template #filterTypeString\r\n             let-column=\'column\'>\r\n  <mat-form-field\r\n    (click)="$event.stopPropagation()"\r\n    class="filter">\r\n    <input matInput\r\n           [formControl]="filterFormControl(column.key)"\r\n           (keydown)="$event.stopPropagation()"\r\n           (keyup)="$event.stopPropagation()"\r\n           (keypress)="$event.stopPropagation()"\r\n           [placeholder]="column.name"/>\r\n  </mat-form-field>\r\n</ng-template>\r\n',exportAs:"ngx-mat-select-table",changeDetection:r.ChangeDetectionStrategy.OnPush,providers:[{provide:s.NG_VALUE_ACCESSOR,useExisting:r.forwardRef(function(){return m}),multi:!0}],styles:[":host{display:block}:host mat-form-field{width:100%}::ng-deep .mat-select-panel.mat-select-search-table-panel{overflow-x:auto!important}::ng-deep .mat-select-panel.mat-select-search-table-panel .overall-search-toggle{z-index:102;position:absolute;left:13px;top:17px;cursor:pointer}::ng-deep .mat-select-panel.mat-select-search-table-panel ngx-mat-select-search{position:absolute;z-index:101}::ng-deep .mat-select-panel.mat-select-search-table-panel ngx-mat-select-search.hidden{display:none}::ng-deep .mat-select-panel.mat-select-search-table-panel ngx-mat-select-search .mat-select-search-inner{height:56px}::ng-deep .mat-select-panel.mat-select-search-table-panel ngx-mat-select-search .mat-select-search-inner .mat-select-search-input{margin-left:26px;width:calc(100% - 26px)}::ng-deep .mat-select-panel.mat-select-search-table-panel table{width:100%}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr{cursor:pointer;height:48px;max-height:48px}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr mat-option{height:48px;max-height:48px}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr.active{background:rgba(0,0,0,.04)}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr td{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-bottom:0!important;box-shadow:inset 0 -1px 0 0 rgba(0,0,0,.12)}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th ::ng-deep .mat-sort-header-container{height:55px}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th ::ng-deep .mat-sort-header-container mat-form-field .mat-form-field-infix{width:initial}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th[aria-sort] ::ng-deep .mat-sort-header-arrow{opacity:1!important}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr td mat-option,::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th mat-option{background:0 0!important}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr td.selection,::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th.selection{width:56px;padding:0;margin:0}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr td.selection.hidden mat-option,::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th.selection.hidden mat-option{visibility:hidden}"]}]}],m.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},m.propDecorators={dataSource:[{type:r.Input}],multiple:[{type:r.Input}],overallSearchEnabled:[{type:r.Input}],overallSearchVisible:[{type:r.Input}],resetSortOnOpen:[{type:r.Input}],resetFiltersOnOpen:[{type:r.Input}],customTriggerLabelFn:[{type:r.Input}],triggerLabelSort:[{type:r.Input}],customTriggerLabelTemplate:[{type:r.Input}],labelForNullValue:[{type:r.Input}],matSelectConfigurator:[{type:r.Input}],matSelectSearchConfigurator:[{type:r.Input}],defaultSort:[{type:r.Input}],close:[{type:r.Output}],matSelect:[{type:r.ViewChild,args:["componentSelect"]}],matSelectSearch:[{type:r.ViewChild,args:[o.MatSelectSearchComponent]}],sort:[{type:r.ViewChild,args:[i.MatSort]}],table:[{type:r.ViewChild,args:[i.MatTable]}],tableRef:[{type:r.ViewChild,args:["table",{read:r.ElementRef}]}],matOptions:[{type:r.ViewChildren,args:[i.MatOption]}]},m);function m(e){this.cd=e,this.nullRow={id:null},this.close=new r.EventEmitter,this.completeRowList=[],this.completeValueList=[],this.controlValueAccessorKeys=["formControl","formControlName","formGroup","formGroupName","formArray","formArrayName"],this._onDestroy=new t.Subject,this._onSelectOpen=new t.Subject,this._onOptionsChange=new t.Subject,this.tableColumnsMap=new Map,this.filterControls=new s.FormGroup({}),this.overallFilterControl=new s.FormControl("")}var f=(h.decorators=[{type:r.NgModule,args:[{declarations:[p],imports:[n.CommonModule,s.FormsModule,s.ReactiveFormsModule,i.MatSelectModule,i.MatSortModule,i.MatOptionModule,i.MatCommonModule,i.MatTableModule,i.MatInputModule,i.MatIconModule,o.NgxMatSelectSearchModule],providers:[],bootstrap:[p],exports:[p]}]}],h);function h(){}e.MatSelectTableComponent=p,e.NgxMatSelectTableModule=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-mat-select-table.umd.min.js.map